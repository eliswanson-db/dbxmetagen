bundle:
  name: dbxmetagen
  databricks_cli_version: ">=0.234.*"

include:
  - resources/jobs/*.yml
  - resources/apps/*.yml  # Temporarily disabled to fix state mismatch - re-enable after bundle works
  - benchmarks/resources/jobs/benchmarks/*.yml
  - variables.yml
  - resources/app_variables.yml
  #- resources/secrets.yml


artifacts:
  default:
    type: whl
    build: poetry build
    path: .

targets:
#   dev_spn:
#     mode: development

#     workspace:
#       #root_path: ${var.current_working_directory}
#       host: https://adb-830292400663869.9.azuredatabricks.net/ #<Update dev host name here to use DAB deploy>
#     permissions:
#       - user_name: ${var.deploying_user}
#         level: CAN_MANAGE

  dev:
    mode: development
    default: true

    workspace:
      #root_path: ${var.current_working_directory}
      host: https://adb-830292400663869.9.azuredatabricks.net/ #<Update dev host name here to use DAB deploy>
    permissions:
      - user_name: ${var.deploying_user}
        level: CAN_MANAGE

  prod:
    mode: production
    workspace:
      host: https://adb-830292400663869.9.azuredatabricks.net/ #<Update prod host name here to use DAB deploy>
      root_path: ${var.current_working_directory}
    permissions:
      - user_name: ${var.current_user}
        level: CAN_MANAGE
      - service_principal_name: ${var.app_service_principal_application_id}
        level: CAN_MANAGE
    run_as:
      user_name: ${var.current_user} #sp name should be used instead for true production cases.


