resources:
  jobs:
    permissions_setup_job:
      name: dbxmetagen_permissions_setup
      
      email_notifications:
        on_failure:
          - ${var.current_user}
        on_success:
          - ${var.current_user}

      parameters:
        - name: catalog_name
          default: ${var.catalog_name}
        - name: app_service_principal
          default: ${var.app_service_principal_application_id}
          # Note: This should be the service principal applicationID, not the name
        - name: schemas
          default: "metadata_results, default, life_sciences_demo"

      tasks:
        - task_key: setup_permissions
          notebook_task:
            notebook_path: ../../app/setup_permissions.py
            base_parameters:
              catalog_name: "{{job.parameters.catalog_name}}"
              app_service_principal: "{{job.parameters.app_service_principal}}"
              schemas: "{{job.parameters.schemas}}"
              
      schedule:
        quartz_cron_expression: "0 0 0 ? * * *"
        timezone_id: "UTC"
        pause_status: "PAUSED"

      max_concurrent_runs: 1
      timeout_seconds: 600