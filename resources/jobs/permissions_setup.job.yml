resources:
  jobs:
    permissions_setup_job:
      name: dbxmetagen_permissions_setup
      
      email_notifications:
        on_failure:
          - ${var.current_user}
        on_success:
          - ${var.current_user}

      parameters:
        - name: catalog_name
          default: ${var.catalog_name}
        - name: app_service_principal
          default: "dbxmetagen-app" 

      tasks:
        - task_key: setup_permissions
          job_cluster_key: serverless_cluster
          sql_task:
            file:
              path: ../../app/setup_permissions.sql
            parameters:
              catalog_name: "{{job.parameters.catalog_name}}"
              app_service_principal: "{{job.parameters.app_service_principal}}"
          
      schedule:
        quartz_cron_expression: "0 0 0 ? * * *"
        timezone_id: "UTC"
        pause_status: "PAUSED"

      max_concurrent_runs: 1
      timeout_seconds: 600